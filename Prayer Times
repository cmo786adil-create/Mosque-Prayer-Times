<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ghausia Mosque Prayer Time</title>
<style>
  body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
  header { padding:1rem; background:#222; position:sticky; top:0; }
  h1 { margin:0; font-size:18px; }
  .tabs { margin-top:.5rem; display:flex; gap:.5rem; }
  .tab { background:#333; color:#eee; padding:.4rem .7rem; border-radius:5px; cursor:pointer; }
  .tab.active { background:#0f0; color:#000; font-weight:bold; }
  main { padding:1rem; }
  .card { background:#222; padding:1rem; border-radius:8px; margin-bottom:1rem; }
  input,button { padding:.5rem; border-radius:5px; border:none; }
  input { background:#333; color:#eee; }
  button { background:#0f0; color:#000; font-weight:bold; cursor:pointer; }
  button.secondary { background:#444; color:#eee; }
  table { width:100%; border-collapse:collapse; margin-top:.5rem; font-size:14px; }
  th,td { border:1px solid #444; padding:.3rem; text-align:center; }
  td[contenteditable="true"] { background:#333; }
  tr.today { background:#0f03; } /* highlight today */
  .hide { display:none; }
</style>
</head>
<body>
  <header>
    <h1>Ghausia Mosque Prayer Time</h1>
    <div class="tabs">
      <button class="tab active" data-tab="public">Prayer Times</button>
      <button class="tab" data-tab="admin">Admin</button>
    </div>
  </header>

  <main>
    <!-- PUBLIC TAB -->
    <section id="public" class="card">
      <div id="todayBox"></div>
      <div id="tableWrap"></div>
    </section>

    <!-- ADMIN TAB -->
    <section id="admin" class="card hide">
      <div id="adminGate">
        <input id="pwd" type="password" placeholder="Enter password" />
        <button id="loginBtn">Login</button>
        <div id="loginMsg" style="color:red; display:none;">Wrong password</div>
      </div>

      <div id="adminArea" class="hide">
        <input id="csvInput" type="file" accept=".csv" />
        <button id="saveBtn">Save Table</button>
      </div>
    </section>
  </main>

<script>
/* ---------------- PASSWORD ---------------- */
const PASSWORD = atob("MDc4NjA="); // "07860"

/* ---------------- DATA ---------------- */
const STORAGE_KEY = "prayerTimesTableCSV";
function saveData(rows){ localStorage.setItem(STORAGE_KEY, JSON.stringify(rows)); }
function loadData(){ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }

/* ---------------- RENDER ---------------- */
function renderToday(rows){
  if(!rows.length){ document.getElementById("todayBox").innerHTML="No data yet."; return; }
  const today = new Date().getDate();
  let row = rows.find(r=>parseInt(r.Date)==today) || rows[rows.length-1];
  let html = `<h3>Today's Times (Day ${row.Date})</h3>`;
  for(let k in row){ 
    if(k!=="Date") html += `<div><b>${k}:</b> ${row[k]}</div>`; 
  }
  document.getElementById("todayBox").innerHTML = html;
}
function renderTable(rows){
  if(!rows.length){ document.getElementById("tableWrap").innerHTML=""; return; }
  const headers = Object.keys(rows[0]);
  const today = new Date().getDate();
  let thead = `<tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr>`;
  let tbody = rows.map(r=>{
    const isToday = parseInt(r.Date) === today;
    return `<tr class="${isToday ? 'today' : ''}">${headers.map(h=>`<td contenteditable="${h!=='Date'}">${r[h]}</td>`).join("")}</tr>`;
  }).join("");
  document.getElementById("tableWrap").innerHTML = `<table>${thead}${tbody}</table>`;
  renderToday(rows);
}

/* ---------------- TABS ---------------- */
document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("public").classList.toggle("hide", btn.dataset.tab!=="public");
    document.getElementById("admin").classList.toggle("hide", btn.dataset.tab!=="admin");
  };
});

/* ---------------- LOGIN ---------------- */
document.getElementById("loginBtn").onclick=()=>{
  if(document.getElementById("pwd").value===PASSWORD){
    document.getElementById("adminGate").classList.add("hide");
    document.getElementById("adminArea").classList.remove("hide");
  } else {
    document.getElementById("loginMsg").style.display="block";
  }
};

/* ---------------- CSV UPLOAD ---------------- */
document.getElementById("csvInput").onchange=(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    const text=reader.result.trim();
    const lines=text.split("\n").map(l=>l.split(","));
    const headers=lines[0];
    const rows=lines.slice(1).map(parts=>{
      const obj={};
      headers.forEach((h,i)=>obj[h.trim()]=parts[i]?parts[i].trim():"");
      return obj;
    });
    saveData(rows);
    renderTable(rows);
  };
  reader.readAsText(file);
};

/* ---------------- SAVE TABLE ---------------- */
document.getElementById("saveBtn").onclick=()=>{
  const rows=[];
  const headers=[...document.querySelectorAll("#tableWrap th")].map(th=>th.textContent);
  document.querySelectorAll("#tableWrap table tr").forEach((tr,i)=>{
    if(i===0) return; // skip header
    const cells=[...tr.children];
    const row={};
    cells.forEach((td,j)=>{ row[headers[j]]=td.textContent.trim(); });
    rows.push(row);
  });
  saveData(rows);
  alert("Saved!");
};

/* ---------------- INIT ---------------- */
renderTable(loadData());
</script>
</body>
</html>
