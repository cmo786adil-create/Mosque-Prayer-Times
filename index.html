<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ghausia Mosque Prayer Time</title>
<style>
  body { 
    margin:0; 
    font-family:sans-serif; 
    background: #0f0 url('https://upload.wikimedia.org/wikipedia/commons/6/6e/Mosque_Sunset.jpg') no-repeat center center fixed;
    background-size: cover;
    color:#eee; 
  }
  header { padding:1rem; background:rgba(0,0,0,0.8); position:sticky; top:0; }
  h1 { margin:0; font-size:18px; }
  .tabs { margin-top:.5rem; display:flex; gap:.5rem; }
  .tab { background:#333; color:#eee; padding:.4rem .7rem; border-radius:5px; cursor:pointer; }
  .tab.active { background:#0f0; color:#000; font-weight:bold; }
  main { padding:1rem; }
  .card { background:rgba(0,0,0,0.8); padding:1rem; border-radius:8px; margin-bottom:1rem; }
  input,button,textarea { padding:.5rem; border-radius:5px; border:none; }
  input,textarea { background:#333; color:#eee; width:100%; }
  button { background:#0f0; color:#000; font-weight:bold; cursor:pointer; }
  button.secondary { background:#444; color:#eee; }
  table { width:100%; border-collapse:collapse; margin-top:.5rem; font-size:14px; }
  th,td { border:1px solid #444; padding:.3rem; text-align:center; }
  td[contenteditable="true"] { background:#333; }
  tr.today { background:#0f03; }
  .hide { display:none; }
  #hadithBox { background:#111; padding:1rem; margin:1rem; border-radius:8px; font-style:italic; }
</style>
</head>
<body>
  <header>
    <h1>Ghausia Mosque Prayer Time</h1>
    <div class="tabs">
      <button class="tab active" data-tab="public">Prayer Times</button>
      <button class="tab" data-tab="admin">Admin</button>
    </div>
  </header>

  <!-- HADITH OF THE MONTH -->
  <section id="hadithBox" class="card">
    <h3>Hadith of the Month</h3>
    <div id="hadithText">No hadith set yet.</div>
  </section>

  <main>
    <!-- PUBLIC TAB -->
    <section id="public" class="card">
      <div id="todayBox"></div>
      <div id="tableWrap"></div>
    </section>

    <!-- ADMIN TAB -->
    <section id="admin" class="card hide">
      <div id="adminGate">
        <input id="pwd" type="password" placeholder="Enter password" />
        <button id="loginBtn">Login</button>
        <div id="loginMsg" style="color:red; display:none;">Wrong password</div>
      </div>

      <div id="adminArea" class="hide">
        <input id="csvInput" type="file" accept=".csv" />
        <button id="saveBtn">Save Table</button>
        <hr>
        <h3>Edit Hadith of the Month</h3>
        <textarea id="hadithInput" rows="3" placeholder="Type new hadith..."></textarea>
        <button id="saveHadithBtn">Save Hadith</button>
      </div>
    </section>
  </main>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <!-- Your custom script -->
  <script>
  /* ---------------- PASSWORD ---------------- */
  const PASSWORD = atob("MDc4NjA="); // "07860"

  /* ---------------- ADMIN UID ---------------- */
  const ADMIN_UID = "zfdCu8n5thWBEPWyqkPbAixA3Ho2";

  /* ---------------- FIREBASE CONFIG ---------------- */
  const firebaseConfig = {
    apiKey: "AIzaSyDtrSvVSBZBASmn-f2SnqzWQDTpa9OSFA8",
    authDomain: "ghausia-mosque.firebaseapp.com",
    databaseURL: "https://ghausia-mosque-default-rtdb.firebaseio.com",
    projectId: "ghausia-mosque",
    storageBucket: "ghausia-mosque.appspot.com",
    messagingSenderId: "967127501442",
    appId: "1:967127501442:web:31e3397f238bee9792c29b",
    measurementId: "G-1207G9PLRJ"
  };
  firebase.initializeApp(firebaseConfig);

  /* ---------------- DATA KEYS ---------------- */
  const db = firebase.database();
  const timetableRef = db.ref("timetable");
  const hadithRef = db.ref("hadith");

  /* ---------------- RENDER ---------------- */
  function renderTable(rows){
    if(!rows.length){ document.getElementById("tableWrap").innerHTML=""; return; }
    const headers = Object.keys(rows[0]);
    const today = new Date().getDate();
    let thead = `<tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr>`;
    let tbody = rows.map(r=>{
      const isToday = parseInt(r.Date) === today;
      return `<tr class="${isToday ? 'today' : ''}">${headers.map(h=>`<td>${r[h]}</td>`).join("")}</tr>`;
    }).join("");
    document.getElementById("tableWrap").innerHTML = `<table>${thead}${tbody}</table>`;
  }

  function renderHadith(text){
    document.getElementById("hadithText").innerText = text;
  }

  /* ---------------- TABS ---------------- */
  document.querySelectorAll(".tab").forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById("public").classList.toggle("hide", btn.dataset.tab!=="public");
      document.getElementById("admin").classList.toggle("hide", btn.dataset.tab!=="admin");
    };
  });

  /* ---------------- LOGIN ---------------- */
  document.getElementById("loginBtn").onclick=()=>{
    if(document.getElementById("pwd").value===PASSWORD){
      document.getElementById("adminGate").classList.add("hide");
      document.getElementById("adminArea").classList.remove("hide");
    } else {
      document.getElementById("loginMsg").style.display="block";
    }
  };

  /* ---------------- SAVE TABLE ---------------- */
  document.getElementById("saveBtn").onclick=()=>{
    const rows = [];
    const table = document.querySelector("#tableWrap table");
    if(!table) return;
    const headers = [...table.querySelectorAll("th")].map(th=>th.textContent);
    table.querySelectorAll("tr").forEach((tr,i)=>{
      if(i===0) return;
      const row={};
      [...tr.children].forEach((td,j)=>{ row[headers[j]]=td.textContent.trim(); });
      rows.push(row);
    });
    timetableRef.set(rows).then(()=>alert("Saved!"));
  };

  /* ---------------- SAVE HADITH ---------------- */
  document.getElementById("saveHadithBtn").onclick=()=>{
    const text = document.getElementById("hadithInput").value.trim();
    if(text){
      hadithRef.set(text).then(()=>renderHadith(text));
      alert("Hadith saved!");
    }
  };

  /* ---------------- REALTIME LISTENERS ---------------- */
  timetableRef.on("value", snapshot=>{
    const val = snapshot.val() || [];
    renderTable(val);
  });

  hadithRef.on("value", snapshot=>{
    const val = snapshot.val() || "No hadith set yet.";
    renderHadith(val);
  });

  </script>
</body>
</html>
